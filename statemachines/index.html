<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>State Machines - 17638 Engineering Embedded Systems</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "State Machines";
        var mkdocs_page_input_path = "statemachines.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 17638 Engineering Embedded Systems
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../coursehardware/">Course Hardware</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../objdump/">Toolchain - objdump</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mapfiles/">Toolchain - map files</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">State Machines</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#types-of-state-machines">Types of State Machines</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#background">Background</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#design-guidance">Design Guidance</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#elements-in-a-state-machine">Elements in a State Machine</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#modeling-state-machines">Modeling State Machines</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example-for-state-machine-implementations">Example for State Machine Implementations</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#implementing-state-machines">Implementing State Machines</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#conditional-statements">Conditional Statements</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#lookup-tables">Lookup Tables</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../syllabus/">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">17638 Engineering Embedded Systems</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">State Machines</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="design-element-state-machines">Design Element: State Machines</h1>
<p>Relevant Links
- required literature reading</p>
<h2 id="types-of-state-machines">Types of State Machines</h2>
<ul>
<li>HSM - Heirarchichal State Machines</li>
<li>FSM - Finite State Machine</li>
</ul>
<h2 id="background">Background</h2>
<ul>
<li>What are state machines</li>
<li>Linking state machines to the behavior of contolled objects</li>
<li>Linking state machines to events and time</li>
<li>Processes, Transitions, and Constraints</li>
</ul>
<h2 id="design-guidance">Design Guidance</h2>
<ul>
<li>Changes in enviornment state</li>
<li>Needed behavioral changes in the application<ul>
<li>Example: </li>
</ul>
</li>
</ul>
<h2 id="elements-in-a-state-machine">Elements in a State Machine</h2>
<ul>
<li>Activities</li>
<li>State Transitions</li>
</ul>
<h2 id="modeling-state-machines">Modeling State Machines</h2>
<ul>
<li>Modeling techniques for State Machines</li>
<li>State Diagrams, State Charts</li>
<li>UML</li>
<li>SysML</li>
</ul>
<h2 id="example-for-state-machine-implementations">Example for State Machine Implementations</h2>
<h2 id="implementing-state-machines">Implementing State Machines</h2>
<h2 id="conditional-statements">Conditional Statements</h2>
<pre><code>- Code Snippet

```C
    // Define states
typedef enum {
    STATE_IDLE,
    STATE_RUNNING,
} State;

typedef enum {
    EVENT_START,
    EVENT_STOP
} Event

event = getEvent();

switch (currentState) {
case STATE_IDLE:
    if (event == EVENT_START) {
        // Transition to next state
        currentState = STATE_RUNNING;
    }
    break;
case STATE_RUNNING:
    if (event == EVENT_STOP) {
        // Transition to idle state
        currentState = STATE_IDLE;
    }
    break;
    // Add more states as needed
}

```

- Discussion
Conditional state machines are the simplest to implement and maintain.  There are no fancy tricks with referncing or structs that need to be coded.  The switch/case block is typically located in a processing loop and executed frequently.  Placing code that queries external conditions can be a matter of taste, being either inside the control loop, the switch case block, or elsewhere, but the point to note is that collecting variables or querying an RT Image is going to be a design concern.  For relatively small state machines, the switch is very maintainable, but when lots of states or transition events have to be designed, then it becomes problematic to update.  This is due to being constrained to one block of code or relocating case code into functions.  Care has to be taken refactoring switch case statements to avoid maintenaince problems.

- Pros
    - Simple, with no pointers, easy to maintain when small

- Cons
    - Quickly becomes a maintenaince problem with lots of states
</code></pre>
<h2 id="lookup-tables">Lookup Tables</h2>
<pre><code>```C
#include &lt;stdio.h&gt;

// Define states
typedef enum {
    STATE_RED,
    STATE_GREEN,
    STATE_YELLOW,
    STATE_MAX
} State;

// Define events
typedef enum {
    EVENT_TIMER_EXPIRED,
    EVENT_MAX
} Event;

// Function prototypes for state actions
void redAction(void);
void greenAction(void);
void yellowAction(void);

// State transition structure
typedef struct {
    State currentState;
    Event event;
    State nextState;
    void (*action)(void);
} StateTransition;

// State transition table
StateTransition stateTable[] = {
    {STATE_RED, EVENT_TIMER_EXPIRED, STATE_GREEN, greenAction},
    {STATE_GREEN, EVENT_TIMER_EXPIRED, STATE_YELLOW, yellowAction},
    {STATE_YELLOW, EVENT_TIMER_EXPIRED, STATE_RED, redAction}
};

// Current state
State currentState = STATE_RED;

// State action functions
void redAction(void) {
    printf("Red Light\n");
}

void greenAction(void) {
    printf("Green Light\n");
}

void yellowAction(void) {
    printf("Yellow Light\n");
}

// Function to handle events
void handleEvent(Event event) {
    for (int i = 0; i &lt; sizeof(stateTable) / sizeof(StateTransition); i++) {
        if (stateTable[i].currentState == currentState &amp;&amp; stateTable[i].event == event) {
            stateTable[i].action();
            currentState = stateTable[i].nextState;
            break;
        }
    }
}

int main() {
    // Simulate timer events
    for (int i = 0; i &lt; 6; i++) {
        handleEvent(EVENT_TIMER_EXPIRED);
    }
    return 0;
}

```
- Explanation
    State and Event Definitions: Enumerations are used to define the states and events.
    State Transition Table: An array of StateTransition structures maps the current state and event to the next state and the action to be performed.
    State Action Functions: Functions that define the actions for each state.
    Event Handling: The handleEvent function iterates through the state transition table to find the matching state and event, performs the action, and updates the current state.
    Main Function: Simulates timer events to demonstrate the state transitions.

- Pros
    - State transition table is easily defined
    - Functions are mapped to actions that take place on transitions

- Cons
    - Event Handling loop must iterate over the entire state space
    - Handling non-deterministic FSM's in a generic way complicates the example.  
    - Handling more than one event or more than one possible transition makes it also more complicated.
</code></pre>
<ul>
<li>
<p>State Pattern</p>
<p>```C</p>
<h1 id="include">include <stdio.h></h1>
<p>// Forward declarations of state structures
typedef struct State State;</p>
<p>// Function pointers for state actions
typedef void (*StateAction)(void);</p>
<p>// State structure
struct State {
    StateAction enter;
    StateAction execute;
    StateAction exit;
};</p>
<p>// Function prototypes for state actions
void idleEnter(void);
void idleExecute(void);
void idleExit(void);
void selectingEnter(void);
void selectingExecute(void);
void selectingExit(void);
void dispensingEnter(void);
void dispensingExecute(void);
void dispensingExit(void);</p>
<p>// State instances
State idleState = {idleEnter, idleExecute, idleExit};
State selectingState = {selectingEnter, selectingExecute, selectingExit};
State dispensingState = {dispensingEnter, dispensingExecute, dispensingExit};</p>
<p>// Current state pointer
State* currentState = &idleState;</p>
<p>// State action functions
void idleEnter(void) {
    printf("Entering Idle State\n");
}</p>
<p>void idleExecute(void) {
    printf("Idle State: Waiting for selection\n");
    // Simulate event to transition to selecting state
    currentState = &selectingState;
    currentState-&gt;enter();
}</p>
<p>void idleExit(void) {
    printf("Exiting Idle State\n");
}</p>
<p>void selectingEnter(void) {
    printf("Entering Selecting State\n");
}</p>
<p>void selectingExecute(void) {
    printf("Selecting State: Making a selection\n");
    // Simulate event to transition to dispensing state
    currentState = &dispensingState;
    currentState-&gt;enter();
}</p>
<p>void selectingExit(void) {
    printf("Exiting Selecting State\n");
}</p>
<p>void dispensingEnter(void) {
    printf("Entering Dispensing State\n");
}</p>
<p>void dispensingExecute(void) {
    printf("Dispensing State: Dispensing item\n");
    // Simulate event to transition back to idle state
    currentState = &idleState;
    currentState-&gt;enter();
}</p>
<p>void dispensingExit(void) {
    printf("Exiting Dispensing State\n");
}</p>
<p>// Function to update the state machine
void updateStateMachine(void) {
    currentState-&gt;execute();
}</p>
<p>int main() {
    // Initial state entry
    currentState-&gt;enter();</p>
<pre><code>// Simulate state machine updates
for (int i = 0; i &lt; 3; i++) {
    updateStateMachine();
}

return 0;
</code></pre>
<p>}
    ```</p>
<ul>
<li>
<p>Explanation
    State Structure: The State structure contains function pointers for the enter, execute, and exit actions.
    State Instances: Instances of the State structure are created for each state (Idle, Selecting, Dispensing).
    State Action Functions: Functions that define the actions for each state.
    State Transitions: The execute function of each state simulates events that cause transitions to other states by updating the currentState pointer and calling the enter function of the new state.
    State Machine Update: The updateStateMachine function calls the execute function of the current state.
    Main Function: Initializes the state machine and simulates state machine updates.</p>
</li>
<li>
<p>Pros</p>
<ul>
<li>Easier to manage state actions</li>
<li>More modular than conditional state machine implementations</li>
<li>Transitions defined inside states gets around lookup table limitations</li>
</ul>
</li>
<li>
<p>Cons</p>
<ul>
<li>Use of pointers can be prohibited by safety standards</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="discussion-of-types">Discussion of Types</h2>
<h2 id="more-on-state-machines">More on State Machines</h2>
<p>https://www.youtube.com/watch?v=NTEHRjiAY2I</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../mapfiles/" class="btn btn-neutral float-left" title="Toolchain - map files"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../syllabus/" class="btn btn-neutral float-right" title="About">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../mapfiles/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../syllabus/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
